<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Karma Betting Calculator - caustic.info</title>
    <link rel="icon" href="https://raw.githubusercontent.com/potatocaustic/web-stuff/refs/heads/main/favicon.ico" type="image/x-icon" />
    <style>
      /* Reset and General Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        color: #333;
        line-height: 1.6;
      }
      
      h1, h2, h3 {
        color: #333;
      }

      /* Main site header style - matching your other pages */
      header {
        background-color: #333;
        color: #fff;
        padding: 1rem;
        text-align: center;
      }
      
      header h1 {
        color: white !important;
        font-size: 1.5rem;
        margin: 0;
      }
      
      /* Navigation styling */
      nav ul {
        display: flex;
        justify-content: center;
        list-style: none;
        margin-top: 1rem;
        flex-wrap: wrap;
      }
      
      nav ul li {
        margin: 0.5rem 1rem;
      }
      
      nav ul li a {
        color: #fff;
        text-decoration: none;
        font-size: 1.1rem;
        transition: color 0.3s ease;
        white-space: nowrap;
      }
      
      nav ul li a:hover {
        color: #ccc;
      }
      
      /* Mobile navigation styles */
      @media (max-width: 600px) {
        nav {
          width: 100%;
          padding: 0;
        }
        
        nav ul {
          flex-direction: column;
          align-items: center;
          gap: 0.5rem;
          padding: 0;
          width: 100%;
          margin-left: 0;
          margin-right: 0;
        }
        
        nav ul li {
          margin: 0.2rem 0;
          width: 100%;
          text-align: center;
        }
        
        nav ul li a {
          display: block;
          padding: 0.5rem 0;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          width: 100%;
          margin: 0 auto;
        }
        
        nav ul li:last-child a {
          border-bottom: none;
        }
      }

      /* Main content area */
      main {
        padding: 2rem;
        max-width: 1200px;
        margin: 0 auto;
        display: none; /* Hide main content initially for auth */
      }

      main.visible { /* Class to show main content, added by auth.js */
        display: block;
      }
      
      /* Info Section */
      .info {
        text-align: center;
        margin-bottom: 1.5rem;
      }
      
      .info p {
        margin-bottom: 0.5rem;
      }

      /* Footer */
      footer {
        text-align: center;
        margin-top: 2rem;
        padding: 1rem;
        background-color: #333;
        color: #fff;
      }
      
      /* Calculator specific styles */
      .container {
        width: 100%;
        margin: 0 auto;
        background-color: #fff;
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      
      .section {
        margin-bottom: 1.5rem;
        padding: 1rem;
        border-radius: 8px;
        background-color: #f9f9f9;
        border: 1px solid #eee;
      }
      
      .section-title {
        margin-bottom: 1rem;
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
      }
      
      .grid {
        display: grid;
        gap: 1.5rem;
      }
      
      @media (min-width: 768px) {
        .grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      
      .three-way .grid {
        grid-template-columns: 1fr;
      }
      
      @media (min-width: 768px) {
        .three-way .grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      
      .input-group {
        margin-bottom: 1rem;
      }
      
      .label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: bold;
        font-size: 0.95rem;
        color: #333;
      }
      
      .input {
        width: 100%;
        padding: 0.8rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
      }
      
      .input:focus {
        outline: none;
        border-color: #333;
      }
      
      .input-wrapper {
        position: relative;
        display: flex;
      }
      
      .button-group {
        display: flex;
        margin-left: 0.5rem;
      }
      
      .button {
        background-color: #f4f4f4;
        border: 1px solid #ddd;
        color: #333;
        width: 40px;
        height: 40px;
        font-size: 1.25rem;
        font-weight: bold;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 0.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease;
      }
      
      .button:hover {
        background-color: #e0e0e0;
      }
      
      .text-button {
        background-color: #f4f4f4;
        border: 1px solid #ddd;
        color: #333;
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
        border-radius: 4px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        margin-top: 0.5rem;
        transition: background-color 0.3s ease;
      }
      
      .text-button:hover {
        background-color: #e0e0e0;
      }
      
      .reset-button {
        background-color: #f8d7da;
        border: 1px solid #f5c2c7;
        color: #842029;
        padding: 0.6rem 1.2rem;
        font-size: 1rem;
        border-radius: 4px;
        cursor: pointer;
        margin-bottom: 1.5rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.3s ease;
      }
      
      .reset-button:hover {
        background-color: #f5c2c7;
      }
      
      .radio-group {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
      
      .radio-label {
        display: inline-flex;
        align-items: center;
        padding: 0.6rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        background-color: #fff;
        cursor: pointer;
        flex: 1;
        min-width: calc(33.33% - 0.5rem);
        justify-content: center;
        transition: all 0.3s ease;
      }
      
      @media (max-width: 767px) {
        .radio-label {
          min-width: calc(50% - 0.5rem);
        }
      }
      
      .radio-label:hover {
        background-color: #f4f4f4;
      }
      
      .radio-label-selected {
        background-color: #333;
        color: #fff;
        border-color: #333;
      }
      
      .radio-input {
        margin-right: 0.5rem;
      }
      
      .result-card {
        background-color: #fff;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1rem;
        border: 1px solid #eee;
      }
      
      .result-title {
        font-size: 1.1rem;
        margin-bottom: 0.75rem;
        text-align: center;
        font-weight: bold;
        color: #333;
      }
      
      .result-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      
      .three-way-results {
        display: grid;
        gap: 1rem;
        grid-template-columns: 1fr;
      }
      
      @media (min-width: 768px) {
        .three-way-results {
          grid-template-columns: repeat(3, 1fr);
        }
      }
      
      .recommendation {
        background-color: #f0f8ff;
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
        margin: 0 0 1.5rem 0;
        border: 1px solid #cce5ff;
      }
      
      .ev-positive {
        color: #155724;
        font-weight: bold;
      }
      
      .ev-negative {
        color: #721c24;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Karma Betting Expected Value Calculator</h1>
      <nav>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="../RKL/rkl-stats.html">Jammers Stats</a></li>
          <li><a href="PSPs/mlb-psp.html">MLB PSP Database</a></li>
          <li><a href="PSPs-WNBA/wnba-psp.html">WNBA PSP Database</a></li>
          <li><a href="karma-calculator.html">Karma EV Calculator</a></li>
          </ul>
      </nav>
    </header>

    <div id="auth-container" style="padding: 2rem; max-width: 400px; margin: 2rem auto; background-color: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center;">
      <h2 id="auth-title">Login</h2>
      <p id="auth-error" style="color: red; margin-bottom: 1rem; min-height: 1.2em;"></p>

      <div id="login-form">
        <input type="text" id="login-username" placeholder="Username" style="width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        <input type="password" id="login-password" placeholder="Password" style="width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        <button id="login-button" style="background-color: #333; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; width: 100%;">Login</button>
        <p style="margin-top: 1rem;">Don't have an account? <a href="#" id="show-signup">Sign Up</a></p>
      </div>

      <div id="signup-form" style="display: none;">
        <input type="text" id="signup-username" placeholder="Choose Username" style="width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        <input type="password" id="signup-password" placeholder="Choose Password" style="width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        <input type="password" id="signup-confirm-password" placeholder="Confirm Password" style="width: 100%; padding: 0.75rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">
        <button id="signup-button" style="background-color: #5cb85c; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; width: 100%;">Sign Up</button>
        <p style="margin-top: 1rem;">Already have an account? <a href="#" id="show-login">Login</a></p>
      </div>
    </div>

    <main>
      <section class="info">
        <p>Calculate the expected value of karma bets by comparing Real App odds with sportsbook odds.</p>
        <p>Choose between two-way betting (Over/Under, Home/Away) or three-way betting (Home/Draw/Away) for soccer matches.</p>
        <p style="margin-top: 1rem;">
          <a href="karma-calculator-tutorial.html" style="color: #007bff; text-decoration: none; font-weight: bold;">
            📚 New to expected value or need help using this calculator? Check out the tutorial!
          </a>
        </p>
      </section>
      <section class="form-section">
        <div id="calculator-root"></div>
      </section>
    </main>
    <footer>
      <p>&copy; caustic.info</p>
    </footer>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics-compat.js"></script>

    <script src="auth.js"></script>

    <script type="text/babel">
      const { useState, useRef, useEffect } = React;
      
      const KarmaBettingCalculator = () => {
        // State for betting mode
        const [bettingMode, setBettingMode] = React.useState('two-way');
        
        // State for form inputs
        const [realAppOver, setRealAppOver] = React.useState('+100');
        const [realAppUnder, setRealAppUnder] = React.useState('+100');
        const [realAppDraw, setRealAppDraw] = React.useState('+100');
        const [sbOver, setSbOver] = React.useState('');
        const [sbUnder, setSbUnder] = React.useState('');
        const [sbDraw, setSbDraw] = React.useState('');
        const [oddsFormat, setOddsFormat] = React.useState('american');
        const [maxBetSize, setMaxBetSize] = React.useState(100);
        
        // State for calculated values
        const [noVigProbOver, setNoVigProbOver] = React.useState(null);
        const [noVigProbUnder, setNoVigProbUnder] = React.useState(null);
        const [noVigProbDraw, setNoVigProbDraw] = React.useState(null);
        const [evMaxOver, setEvMaxOver] = React.useState(null);
        const [evMaxUnder, setEvMaxUnder] = React.useState(null);
        const [evMaxDraw, setEvMaxDraw] = React.useState(null);
        const [evZeroOver, setEvZeroOver] = React.useState(null);
        const [evZeroUnder, setEvZeroUnder] = React.useState(null);
        const [evZeroDraw, setEvZeroDraw] = React.useState(null);
        
        // Default values for reset functions
        const defaultRealAppOdds = {
          over: '+100',
          under: '+100',
          draw: '+100'
        };
        
        const defaultSbOdds = {
          over: '',
          under: '',
          draw: ''
        };
        
        // Reset functions
        const resetAllInputs = () => {
          setRealAppOver(defaultRealAppOdds.over);
          setRealAppUnder(defaultRealAppOdds.under);
          setRealAppDraw(defaultRealAppOdds.draw);
          setSbOver(defaultSbOdds.over);
          setSbUnder(defaultSbOdds.under);
          setSbDraw(defaultSbOdds.draw);
          setOddsFormat('american');
          setMaxBetSize(100);
        };
        
        const resetRealAppOdds = () => {
          setRealAppOver(defaultRealAppOdds.over);
          setRealAppUnder(defaultRealAppOdds.under);
          setRealAppDraw(defaultRealAppOdds.draw);
        };
        
        const resetSbOdds = () => {
          setSbOver(defaultSbOdds.over);
          setSbUnder(defaultSbOdds.under);
          setSbDraw(defaultSbOdds.draw);
        };
        
        // Refs for input fields to manage focus
        const realAppOverRef = useRef(null);
        const realAppUnderRef = useRef(null);
        const realAppDrawRef = useRef(null);
        const sbOverRef = useRef(null);
        const sbUnderRef = useRef(null);
        const sbDrawRef = useRef(null);
        
        // Focus order for keyboard navigation
        const getTwoWayInputOrder = () => [realAppOverRef, realAppUnderRef, sbOverRef, sbUnderRef];
        const getThreeWayInputOrder = () => [realAppOverRef, realAppUnderRef, realAppDrawRef, sbOverRef, sbUnderRef, sbDrawRef];
        
        // Handle enter key to move to next input
        const handleKeyDown = (e, currentIndex) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            const inputOrder = bettingMode === 'two-way' ? getTwoWayInputOrder() : getThreeWayInputOrder();
            const nextIndex = (currentIndex + 1) % inputOrder.length;
            inputOrder[nextIndex].current.focus();
          }
        };
        
        // Helper function to add plus or minus sign
        const addSign = (value, sign) => {
          if (!value) return sign;
          // Remove any existing sign
          const numberPart = value.replace(/^[+-]/, '');
          return sign + numberPart;
        };
        
        // Helper functions for odds conversion
        const americanToDecimal = (american) => {
          if (!american) return null;
          let value = parseFloat(american);
          if (isNaN(value)) return null;
          
          if (!american.toString().startsWith('-') && !american.toString().startsWith('+')) {
            value = Math.abs(value);
          }
          
          if (value > 0) {
            return (value / 100) + 1;
          } else {
            return (100 / Math.abs(value)) + 1;
          }
        };
        
        const americanToImpliedProb = (american) => {
          const decimal = americanToDecimal(american);
          if (!decimal) return null;
          return 1 / decimal;
        };
        
        const decimalToImpliedProb = (decimal) => {
          if (!decimal) return null;
          const value = parseFloat(decimal);
          if (isNaN(value) || value <= 0) return null;
          return 1 / value;
        };
        
        const calculateNoVigProbabilities = () => {
          let probOver, probUnder, probDraw;
          
          if (oddsFormat === 'american') {
            probOver = americanToImpliedProb(sbOver);
            probUnder = americanToImpliedProb(sbUnder);
            if (bettingMode === 'three-way') {
              probDraw = americanToImpliedProb(sbDraw);
            }
          } else {
            probOver = decimalToImpliedProb(sbOver);
            probUnder = decimalToImpliedProb(sbUnder);
            if (bettingMode === 'three-way') {
              probDraw = decimalToImpliedProb(sbDraw);
            }
          }
          
          if (bettingMode === 'two-way') {
            if (!probOver || !probUnder) return { over: null, under: null, draw: null };
            
            const totalProb = probOver + probUnder;
            const noVigProbOver = probOver / totalProb;
            const noVigProbUnder = probUnder / totalProb;
            
            return { over: noVigProbOver, under: noVigProbUnder, draw: null };
          } else {
            if (!probOver || !probUnder || !probDraw) return { over: null, under: null, draw: null };
            
            const totalProb = probOver + probUnder + probDraw;
            const noVigProbOver = probOver / totalProb;
            const noVigProbUnder = probUnder / totalProb;
            const noVigProbDraw = probDraw / totalProb;
            
            return { over: noVigProbOver, under: noVigProbUnder, draw: noVigProbDraw };
          }
        };
        
        const calculateWinValue = (odds, betSize) => {
          if (!odds) return null;
          let value = parseFloat(odds);
          if (isNaN(value)) return null;
          
          if (!odds.toString().startsWith('-') && !odds.toString().startsWith('+')) {
            value = Math.abs(value);
          }
          
          if (value > 0) {
            return (value / 100) * betSize;
          } else {
            return (100 / Math.abs(value)) * betSize;
          }
        };
        
        const calculateExpectedValue = (winProb, winValue, ...lossEvents) => {
          if (winProb === null || winValue === null) {
            return null;
          }
          
          for (let i = 0; i < lossEvents.length; i += 2) {
            if (lossEvents[i] === null || lossEvents[i + 1] === null) {
              return null;
            }
          }
          
          let ev = winProb * winValue;
          
          for (let i = 0; i < lossEvents.length; i += 2) {
            const lossProb = lossEvents[i];
            const lossValue = lossEvents[i + 1];
            ev += lossProb * lossValue;
          }
          
          return ev;
        };
        
        useEffect(() => {
          const requiredInputs = bettingMode === 'two-way' 
            ? [realAppOver, realAppUnder, sbOver, sbUnder]
            : [realAppOver, realAppUnder, realAppDraw, sbOver, sbUnder, sbDraw];
          
          if (!requiredInputs.every(input => input)) {
            setNoVigProbOver(null); setNoVigProbUnder(null); setNoVigProbDraw(null);
            setEvMaxOver(null); setEvMaxUnder(null); setEvMaxDraw(null);
            setEvZeroOver(null); setEvZeroUnder(null); setEvZeroDraw(null);
            return;
          }
          
          const { over: overProb, under: underProb, draw: drawProb } = calculateNoVigProbabilities();
          setNoVigProbOver(overProb);
          setNoVigProbUnder(underProb);
          setNoVigProbDraw(drawProb);
          
          // This is the line for "zeroBetSize" - it already implements the requested logic.
          const zeroBetSize = maxBetSize >= 100 ? 10 : 5; 

          if (bettingMode === 'two-way') {
            if (overProb === null || underProb === null) {
              setEvMaxOver(null); setEvMaxUnder(null); setEvMaxDraw(null);
              setEvZeroOver(null); setEvZeroUnder(null); setEvZeroDraw(null);
              return;
            }
            
            const winValueMaxOver = calculateWinValue(realAppOver, maxBetSize);
            const lossValueMax = -maxBetSize;
            const evMaxOverCalc = calculateExpectedValue(overProb, winValueMaxOver, underProb, lossValueMax);
            setEvMaxOver(evMaxOverCalc);
            
            const winValueMaxUnder = calculateWinValue(realAppUnder, maxBetSize);
            const evMaxUnderCalc = calculateExpectedValue(underProb, winValueMaxUnder, overProb, lossValueMax);
            setEvMaxUnder(evMaxUnderCalc);
            
            const winValueZeroOver = calculateWinValue(realAppOver, zeroBetSize);
            const evZeroOverCalc = calculateExpectedValue(overProb, winValueZeroOver, 0, 0); // Loss for zero bet is 0
            setEvZeroOver(evZeroOverCalc);
            
            const winValueZeroUnder = calculateWinValue(realAppUnder, zeroBetSize);
            const evZeroUnderCalc = calculateExpectedValue(underProb, winValueZeroUnder, 0, 0); // Loss for zero bet is 0
            setEvZeroUnder(evZeroUnderCalc);
            
            setEvMaxDraw(null);
            setEvZeroDraw(null);
          } else { // three-way
            if (overProb === null || underProb === null || drawProb === null) {
              setEvMaxOver(null); setEvMaxUnder(null); setEvMaxDraw(null);
              setEvZeroOver(null); setEvZeroUnder(null); setEvZeroDraw(null);
              return;
            }
            
            const winValueMaxOver = calculateWinValue(realAppOver, maxBetSize);
            const lossValueMax = -maxBetSize;
            const evMaxOverCalc = calculateExpectedValue(overProb, winValueMaxOver, underProb, lossValueMax, drawProb, lossValueMax);
            setEvMaxOver(evMaxOverCalc);
            
            const winValueMaxUnder = calculateWinValue(realAppUnder, maxBetSize);
            const evMaxUnderCalc = calculateExpectedValue(underProb, winValueMaxUnder, overProb, lossValueMax, drawProb, lossValueMax);
            setEvMaxUnder(evMaxUnderCalc);
            
            const winValueMaxDraw = calculateWinValue(realAppDraw, maxBetSize);
            const evMaxDrawCalc = calculateExpectedValue(drawProb, winValueMaxDraw, overProb, lossValueMax, underProb, lossValueMax);
            setEvMaxDraw(evMaxDrawCalc);
            
            const winValueZeroOver = calculateWinValue(realAppOver, zeroBetSize);
            const evZeroOverCalc = calculateExpectedValue(overProb, winValueZeroOver, 0, 0, 0, 0); // Losses for zero bet are 0
            setEvZeroOver(evZeroOverCalc);
            
            const winValueZeroUnder = calculateWinValue(realAppUnder, zeroBetSize);
            const evZeroUnderCalc = calculateExpectedValue(underProb, winValueZeroUnder, 0, 0, 0, 0); // Losses for zero bet are 0
            setEvZeroUnder(evZeroUnderCalc);
            
            const winValueZeroDraw = calculateWinValue(realAppDraw, zeroBetSize);
            const evZeroDrawCalc = calculateExpectedValue(drawProb, winValueZeroDraw, 0, 0, 0, 0); // Losses for zero bet are 0
            setEvZeroDraw(evZeroDrawCalc);
          }
        }, [realAppOver, realAppUnder, realAppDraw, sbOver, sbUnder, sbDraw, oddsFormat, maxBetSize, bettingMode]);
        
        const getLabels = () => {
          if (bettingMode === 'two-way') {
            return {
              option1: 'Over/Home Team',
              option2: 'Under/Away Team'
            };
          } else {
            return {
              option1: 'Home Team',
              option2: 'Away Team',
              option3: 'Draw'
            };
          }
        };
        
        const labels = getLabels();
        
        return (
          <div className={`container ${bettingMode === 'three-way' ? 'three-way' : ''}`}>
            <div style={{textAlign: 'center', marginBottom: '1rem'}}>
              <button type="button" onClick={resetAllInputs} className="reset-button">
                Reset All Values
              </button>
            </div>
            
            <div className="section">
              <h2 className="section-title">Betting Mode</h2>
              <div className="radio-group">
                <label 
                  className={`radio-label ${bettingMode === 'two-way' ? 'radio-label-selected' : ''}`}
                >
                  <input
                    type="radio"
                    checked={bettingMode === 'two-way'}
                    onChange={() => setBettingMode('two-way')}
                    className="radio-input"
                  />
                  Two-Way (Over/Under, Home/Away)
                </label>
                <label 
                  className={`radio-label ${bettingMode === 'three-way' ? 'radio-label-selected' : ''}`}
                >
                  <input
                    type="radio"
                    checked={bettingMode === 'three-way'}
                    onChange={() => setBettingMode('three-way')}
                    className="radio-input"
                  />
                  Three-Way (Home/Draw/Away)
                </label>
              </div>
            </div>
            
            <div className="section">
              <h2 className="section-title">Maximum Bet Size</h2>
              <div className="radio-group">
                {[50, 100, 200].map(size => (
                  <label 
                    key={size}
                    className={`radio-label ${maxBetSize === size ? 'radio-label-selected' : ''}`}
                  >
                    <input
                      type="radio"
                      checked={maxBetSize === size}
                      onChange={() => setMaxBetSize(size)}
                      className="radio-input"
                    />
                    {size} Karma
                  </label>
                ))}
              </div>
            </div>
            
            <div className="grid">
              <div className="section">
                <h2 className="section-title">Real App Odds</h2>
                <div className="input-group">
                  <label className="label">{labels.option1} Odds:</label>
                  <div className="input-wrapper">
                    <input
                      type="text"
                      inputMode="text"
                      value={realAppOver}
                      onChange={(e) => setRealAppOver(e.target.value)}
                      onKeyDown={(e) => handleKeyDown(e, 0)}
                      placeholder="e.g. +150 or -120"
                      className="input"
                      ref={realAppOverRef}
                    />
                    <div className="button-group">
                      <button
                        type="button"
                        onClick={() => setRealAppOver(prev => addSign(prev, '+'))}
                        className="button"
                      >
                        +
                      </button>
                      <button
                        type="button"
                        onClick={() => setRealAppOver(prev => addSign(prev, '-'))}
                        className="button"
                      >
                        -
                      </button>
                    </div>
                  </div>
                </div>
                <div className="input-group">
                  <label className="label">{labels.option2} Odds:</label>
                  <div className="input-wrapper">
                    <input
                      type="text"
                      inputMode="text"
                      value={realAppUnder}
                      onChange={(e) => setRealAppUnder(e.target.value)}
                      onKeyDown={(e) => handleKeyDown(e, 1)}
                      placeholder="e.g. +150 or -120"
                      className="input"
                      ref={realAppUnderRef}
                    />
                    <div className="button-group">
                      <button
                        type="button"
                        onClick={() => setRealAppUnder(prev => addSign(prev, '+'))}
                        className="button"
                      >
                        +
                      </button>
                      <button
                        type="button"
                        onClick={() => setRealAppUnder(prev => addSign(prev, '-'))}
                        className="button"
                      >
                        -
                      </button>
                    </div>
                  </div>
                </div>
                {bettingMode === 'three-way' && (
                  <div className="input-group">
                    <label className="label">{labels.option3} Odds:</label>
                    <div className="input-wrapper">
                      <input
                        type="text"
                        inputMode="text"
                        value={realAppDraw}
                        onChange={(e) => setRealAppDraw(e.target.value)}
                        onKeyDown={(e) => handleKeyDown(e, 2)}
                        placeholder="e.g. +150 or -120"
                        className="input"
                        ref={realAppDrawRef}
                      />
                      <div className="button-group">
                        <button
                          type="button"
                          onClick={() => setRealAppDraw(prev => addSign(prev, '+'))}
                          className="button"
                        >
                          +
                        </button>
                        <button
                          type="button"
                          onClick={() => setRealAppDraw(prev => addSign(prev, '-'))}
                          className="button"
                        >
                          -
                        </button>
                      </div>
                    </div>
                  </div>
                )}
                <button type="button" onClick={resetRealAppOdds} className="text-button">
                  Clear Real App Odds
                </button>
              </div>
              
              <div className="section">
                <h2 className="section-title">Sportsbook Odds</h2>
                <div className="input-group">
                  <label className="label">Odds Format:</label>
                  <div className="radio-group">
                    <label 
                      className={`radio-label ${oddsFormat === 'american' ? 'radio-label-selected' : ''}`}
                    >
                      <input
                        type="radio"
                        checked={oddsFormat === 'american'}
                        onChange={() => setOddsFormat('american')}
                        className="radio-input"
                      />
                      American (+/-)
                    </label>
                    <label 
                      className={`radio-label ${oddsFormat === 'decimal' ? 'radio-label-selected' : ''}`}
                    >
                      <input
                        type="radio"
                        checked={oddsFormat === 'decimal'}
                        onChange={() => setOddsFormat('decimal')}
                        className="radio-input"
                      />
                      Decimal
                    </label>
                  </div>
                </div>
                <div className="input-group">
                  <label className="label">{labels.option1} Odds:</label>
                  <div className="input-wrapper">
                    <input
                      type="text"
                      inputMode="text"
                      value={sbOver}
                      onChange={(e) => setSbOver(e.target.value)}
                      onKeyDown={(e) => handleKeyDown(e, bettingMode === 'two-way' ? 2 : 3)}
                      placeholder={oddsFormat === 'american' ? "e.g. +150 or -120" : "e.g. 2.50"}
                      className="input"
                      ref={sbOverRef}
                    />
                    {oddsFormat === 'american' && (
                      <div className="button-group">
                        <button
                          type="button"
                          onClick={() => setSbOver(prev => addSign(prev, '+'))}
                          className="button"
                        >
                          +
                        </button>
                        <button
                          type="button"
                          onClick={() => setSbOver(prev => addSign(prev, '-'))}
                          className="button"
                        >
                          -
                        </button>
                      </div>
                    )}
                  </div>
                </div>
                <div className="input-group">
                  <label className="label">{labels.option2} Odds:</label>
                  <div className="input-wrapper">
                    <input
                      type="text"
                      inputMode="text"
                      value={sbUnder}
                      onChange={(e) => setSbUnder(e.target.value)}
                      onKeyDown={(e) => handleKeyDown(e, bettingMode === 'two-way' ? 3 : 4)}
                      placeholder={oddsFormat === 'american' ? "e.g. +150 or -120" : "e.g. 2.50"}
                      className="input"
                      ref={sbUnderRef}
                    />
                    {oddsFormat === 'american' && (
                      <div className="button-group">
                        <button
                          type="button"
                          onClick={() => setSbUnder(prev => addSign(prev, '+'))}
                          className="button"
                        >
                          +
                        </button>
                        <button
                          type="button"
                          onClick={() => setSbUnder(prev => addSign(prev, '-'))}
                          className="button"
                        >
                          -
                        </button>
                      </div>
                    )}
                  </div>
                </div>
                {bettingMode === 'three-way' && (
                  <div className="input-group">
                    <label className="label">{labels.option3} Odds:</label>
                    <div className="input-wrapper">
                      <input
                        type="text"
                        inputMode="text"
                        value={sbDraw}
                        onChange={(e) => setSbDraw(e.target.value)}
                        onKeyDown={(e) => handleKeyDown(e, 5)}
                        placeholder={oddsFormat === 'american' ? "e.g. +150 or -120" : "e.g. 2.50"}
                        className="input"
                        ref={sbDrawRef}
                      />
                      {oddsFormat === 'american' && (
                        <div className="button-group">
                          <button
                            type="button"
                            onClick={() => setSbDraw(prev => addSign(prev, '+'))}
                            className="button"
                          >
                            +
                          </button>
                          <button
                            type="button"
                            onClick={() => setSbDraw(prev => addSign(prev, '-'))}
                            className="button"
                          >
                            -
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                )}
                <button type="button" onClick={resetSbOdds} className="text-button">
                  Clear Sportsbook Odds
                </button>
              </div>
            </div>
            
            {((bettingMode === 'two-way' && noVigProbOver !== null && noVigProbUnder !== null && evMaxOver !== null && evMaxUnder !== null && evZeroOver !== null && evZeroUnder !== null) ||
              (bettingMode === 'three-way' && noVigProbOver !== null && noVigProbUnder !== null && noVigProbDraw !== null && evMaxOver !== null && evMaxUnder !== null && evMaxDraw !== null && evZeroOver !== null && evZeroUnder !== null && evZeroDraw !== null)) && (
              <div className="section">
                <h2 className="section-title">Expected Value Results</h2>
                
                <div className="recommendation" style={{marginTop: 0, marginBottom: '1rem'}}>
                  <div style={{fontWeight: 'bold', fontSize: '1.1rem', marginBottom: '0.5rem'}}>Recommended Bet:</div>
                  {(() => {
                    const zeroBetSize = maxBetSize >= 100 ? 10 : 5; // Ensure this is defined here for recommendation
                    const evOptions = [
                      { type: "Max Bet", value: evMaxOver, side: labels.option1, amount: maxBetSize },
                      { type: "Zero Bet", value: evZeroOver, side: labels.option1, amount: zeroBetSize },
                      { type: "Max Bet", value: evMaxUnder, side: labels.option2, amount: maxBetSize },
                      { type: "Zero Bet", value: evZeroUnder, side: labels.option2, amount: zeroBetSize }
                    ];
                    
                    if (bettingMode === 'three-way') {
                      evOptions.push(
                        { type: "Max Bet", value: evMaxDraw, side: labels.option3, amount: maxBetSize },
                        { type: "Zero Bet", value: evZeroDraw, side: labels.option3, amount: zeroBetSize }
                      );
                    }
                    
                    const bestOption = evOptions.filter(opt => opt.value !== null).reduce((best, current) => 
                      current.value > best.value ? current : best, { value: -Infinity });
                    
                    if (bestOption.value === -Infinity || bestOption.value <= 0) { // check for no valid options or all non-positive EV
                      return <div style={{fontSize: '1.1rem'}}>None - all bets have negative or zero EV</div>;
                    }
                    
                    return (
                      <div style={{fontSize: '1.1rem'}}>
                        {bestOption.type} on {bestOption.side} ({bestOption.amount} karma)
                        <div className="ev-positive" style={{marginTop: '0.5rem'}}>
                          Expected Value: {bestOption.value.toFixed(2)} karma
                        </div>
                      </div>
                    );
                  })()}
                </div>
                
                {bettingMode === 'two-way' ? (
                  <div className="grid">
                    <div className="result-card">
                      <h3 className="result-title">{labels.option1}</h3>
                      <div className="result-grid">
                        <div>
                          <div style={{fontWeight: 'bold'}}>Max Bet EV:</div>
                          <div className={evMaxOver >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evMaxOver !== null ? evMaxOver.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                        <div>
                          <div style={{fontWeight: 'bold'}}>Zero Bet EV:</div>
                          <div className={evZeroOver >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evZeroOver !== null ? evZeroOver.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div className="result-card">
                      <h3 className="result-title">{labels.option2}</h3>
                      <div className="result-grid">
                        <div>
                          <div style={{fontWeight: 'bold'}}>Max Bet EV:</div>
                          <div className={evMaxUnder >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evMaxUnder !== null ? evMaxUnder.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                        <div>
                          <div style={{fontWeight: 'bold'}}>Zero Bet EV:</div>
                          <div className={evZeroUnder >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evZeroUnder !== null ? evZeroUnder.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                ) : ( // three-way
                  <div className="three-way-results">
                    <div className="result-card">
                      <h3 className="result-title">{labels.option1}</h3>
                      <div className="result-grid">
                        <div>
                          <div style={{fontWeight: 'bold'}}>Max Bet EV:</div>
                          <div className={evMaxOver >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evMaxOver !== null ? evMaxOver.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                        <div>
                          <div style={{fontWeight: 'bold'}}>Zero Bet EV:</div>
                          <div className={evZeroOver >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evZeroOver !== null ? evZeroOver.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div className="result-card">
                      <h3 className="result-title">{labels.option2}</h3>
                      <div className="result-grid">
                        <div>
                          <div style={{fontWeight: 'bold'}}>Max Bet EV:</div>
                          <div className={evMaxUnder >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evMaxUnder !== null ? evMaxUnder.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                        <div>
                          <div style={{fontWeight: 'bold'}}>Zero Bet EV:</div>
                          <div className={evZeroUnder >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evZeroUnder !== null ? evZeroUnder.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div className="result-card">
                      <h3 className="result-title">{labels.option3}</h3>
                      <div className="result-grid">
                        <div>
                          <div style={{fontWeight: 'bold'}}>Max Bet EV:</div>
                          <div className={evMaxDraw >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evMaxDraw !== null ? evMaxDraw.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                        <div>
                          <div style={{fontWeight: 'bold'}}>Zero Bet EV:</div>
                          <div className={evZeroDraw >= 0 ? 'ev-positive' : 'ev-negative'}>
                            {evZeroDraw !== null ? evZeroDraw.toFixed(2) + ' karma' : 'N/A'}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}
          </div>
        );
      };
      
      const container = document.getElementById('calculator-root');
      const root = ReactDOM.createRoot(container);
      root.render(<KarmaBettingCalculator />);
    </script>
  </body>
</html>
