<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Karma Betting Calculator - caustic.info</title>
    <link rel="icon" href="https://raw.githubusercontent.com/potatocaustic/web-stuff/refs/heads/main/favicon.ico" type="image/x-icon" />
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
      /* Base styles */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #f5f5f5;
        padding: 0;
        margin: 0;
      }
      
      header {
        background-color: #2c3e50;
        color: white;
        text-align: center;
        padding: 1rem;
      }
      
      h1 {
        font-size: 1.5rem;
        margin: 0;
      }
      
      @media (min-width: 768px) {
        h1 {
          font-size: 2rem;
        }
      }
      
      main {
        padding: 1rem;
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .info {
        text-align: center;
        margin-bottom: 1rem;
      }
      
      footer {
        text-align: center;
        padding: 1rem;
        background-color: #2c3e50;
        color: white;
      }
      
      /* Custom styles for the calculator will be handled by the React component */
    </style>
  </head>
  <body>
    <header>
      <h1>Karma Betting Expected Value Calculator</h1>
    </header>
    <main>
      <section class="info">
        <p>Calculate the expected value of karma bets by comparing Real App odds with Sportsbook odds.</p>
      </section>
      <section class="form-section">
        <!-- This is where our React component will be rendered -->
        <div id="calculator-root"></div>
      </section>
    </main>
    <footer>
      <p>&copy; caustic.info</p>
    </footer>

    <!-- Calculator Script -->
    <script type="text/babel">
      // React component for the Karma Betting Calculator
      const KarmaBettingCalculator = () => {
        // State for form inputs
        const [realAppOver, setRealAppOver] = React.useState('+100');
        const [realAppUnder, setRealAppUnder] = React.useState('+100');
        const [sbOver, setSbOver] = React.useState('');
        const [sbUnder, setSbUnder] = React.useState('');
        const [oddsFormat, setOddsFormat] = React.useState('american');
        const [maxBetSize, setMaxBetSize] = React.useState(100);
        
        // State for calculated values
        const [noVigProbOver, setNoVigProbOver] = React.useState(null);
        const [noVigProbUnder, setNoVigProbUnder] = React.useState(null);
        const [evMaxOver, setEvMaxOver] = React.useState(null);
        const [evMaxUnder, setEvMaxUnder] = React.useState(null);
        const [evZeroOver, setEvZeroOver] = React.useState(null);
        const [evZeroUnder, setEvZeroUnder] = React.useState(null);
        
        // State for screen size
        const [isMobile, setIsMobile] = React.useState(window.innerWidth < 768);
        
        // Update isMobile state when window is resized
        React.useEffect(() => {
          const handleResize = () => {
            setIsMobile(window.innerWidth < 768);
          };
          
          window.addEventListener('resize', handleResize);
          return () => window.removeEventListener('resize', handleResize);
        }, []);
        
        // Refs for input fields to manage focus
        const realAppOverRef = React.useRef(null);
        const realAppUnderRef = React.useRef(null);
        const sbOverRef = React.useRef(null);
        const sbUnderRef = React.useRef(null);
        
        // Focus order for keyboard navigation
        const inputOrder = [realAppOverRef, realAppUnderRef, sbOverRef, sbUnderRef];
        
        // Handle enter key to move to next input
        const handleKeyDown = (e, currentIndex) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            const nextIndex = (currentIndex + 1) % inputOrder.length;
            inputOrder[nextIndex].current.focus();
          }
        };
        
        // Helper functions for odds conversion
        const americanToDecimal = (american) => {
          if (!american) return null;
          let value = parseFloat(american);
          if (isNaN(value)) return null;
          
          // If the string doesn't start with "+", but is a positive number
          // it should be treated as positive American odds
          if (!american.toString().startsWith('-') && !american.toString().startsWith('+')) {
            value = Math.abs(value);
          }
          
          if (value > 0) {
            return (value / 100) + 1;
          } else {
            return (100 / Math.abs(value)) + 1;
          }
        };
        
        const americanToImpliedProb = (american) => {
          const decimal = americanToDecimal(american);
          if (!decimal) return null;
          return 1 / decimal;
        };
        
        const decimalToImpliedProb = (decimal) => {
          if (!decimal) return null;
          const value = parseFloat(decimal);
          if (isNaN(value) || value <= 0) return null;
          return 1 / value;
        };
        
        const calculateNoVigProbabilities = () => {
          let probOver, probUnder;
          
          // Calculate implied probabilities based on selected odds format
          if (oddsFormat === 'american') {
            probOver = americanToImpliedProb(sbOver);
            probUnder = americanToImpliedProb(sbUnder);
          } else {
            probOver = decimalToImpliedProb(sbOver);
            probUnder = decimalToImpliedProb(sbUnder);
          }
          
          if (!probOver || !probUnder) return { over: null, under: null };
          
          // Calculate the vig
          const vig = probOver + probUnder - 1;
          
          // Remove the vig to get the no-vig probabilities
          const noVigProbOver = probOver / (probOver + probUnder);
          const noVigProbUnder = probUnder / (probOver + probUnder);
          
          return { over: noVigProbOver, under: noVigProbUnder };
        };
        
        const calculateWinValue = (odds, betSize) => {
          if (!odds) return null;
          let value = parseFloat(odds);
          if (isNaN(value)) return null;
          
          // If the string doesn't start with "+", but is a positive number
          // it should be treated as positive American odds
          if (!odds.toString().startsWith('-') && !odds.toString().startsWith('+')) {
            value = Math.abs(value);
          }
          
          if (value > 0) {
            return (value / 100) * betSize;
          } else {
            return (100 / Math.abs(value)) * betSize;
          }
        };
        
        const calculateExpectedValue = (winProb, winValue, lossProb, lossValue) => {
          if (winProb === null || winValue === null || lossProb === null || lossValue === null) {
            return null;
          }
          return (winProb * winValue) + (lossProb * lossValue);
        };
        
        // Update calculations when inputs change
        React.useEffect(() => {
          if (!realAppOver || !realAppUnder || !sbOver || !sbUnder) {
            // Don't calculate if inputs are missing
            return;
          }
          
          const { over: overProb, under: underProb } = calculateNoVigProbabilities();
          setNoVigProbOver(overProb);
          setNoVigProbUnder(underProb);
          
          if (overProb === null || underProb === null) {
            return;
          }
          
          // Calculate max bet EVs
          const winValueMaxOver = calculateWinValue(realAppOver, maxBetSize);
          const lossValueMax = -maxBetSize;
          const evMaxOverCalc = calculateExpectedValue(overProb, winValueMaxOver, underProb, lossValueMax);
          setEvMaxOver(evMaxOverCalc);
          
          const winValueMaxUnder = calculateWinValue(realAppUnder, maxBetSize);
          const evMaxUnderCalc = calculateExpectedValue(underProb, winValueMaxUnder, overProb, lossValueMax);
          setEvMaxUnder(evMaxUnderCalc);
          
          // Calculate zero bet EVs
          const zeroBetSize = maxBetSize >= 100 ? 10 : 5;
          const winValueZeroOver = calculateWinValue(realAppOver, zeroBetSize);
          const evZeroOverCalc = calculateExpectedValue(overProb, winValueZeroOver, 0, 0);
          setEvZeroOver(evZeroOverCalc);
          
          const winValueZeroUnder = calculateWinValue(realAppUnder, zeroBetSize);
          const evZeroUnderCalc = calculateExpectedValue(underProb, winValueZeroUnder, 0, 0);
          setEvZeroUnder(evZeroUnderCalc);
        }, [realAppOver, realAppUnder, sbOver, sbUnder, oddsFormat, maxBetSize]);
        
        // Custom Radio Button component for better mobile experience
        const CustomRadio = ({ checked, onChange, label, value }) => {
          return (
            <label 
              style={{
                ...styles.radioLabel,
                ...(checked ? styles.radioLabelSelected : {})
              }}
            >
              <input
                type="radio"
                checked={checked}
                onChange={onChange}
                value={value}
                style={{ marginRight: '0.5rem' }}
              />
              {label}
            </label>
          );
        };
          section: {
            marginBottom: '1rem',
            padding: '0.75rem',
            borderRadius: '8px',
            backgroundColor: '#f9f9f9',
            border: '1px solid #eee'
          },
          grid: {
            display: 'grid',
            gridTemplateColumns: isMobile ? '1fr' : 'repeat(2, 1fr)',
            gap: '1rem',
            marginBottom: '1rem'
          },
          inputGroup: {
            marginBottom: '0.75rem'
          },
          label: {
            display: 'block',
            marginBottom: '0.5rem',
            fontWeight: 'bold',
            fontSize: '0.95rem'
          },
          input: {
            width: '100%',
            padding: '0.75rem',
            border: '1px solid #ccc',
            borderRadius: '4px',
            fontSize: '1rem',
            appearance: 'none'
          },
          inputWrapper: {
            position: 'relative',
            display: 'flex',
            alignItems: 'center'
          },
          symbolButtons: {
            display: 'flex',
            marginLeft: '0.5rem'
          },
          symbolButton: {
            width: '36px',
            height: '36px',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            backgroundColor: '#e3f2fd',
            color: '#0d47a1',
            border: '1px solid #bbdefb',
            borderRadius: '4px',
            fontSize: '1.25rem',
            fontWeight: 'bold',
            cursor: 'pointer',
            marginRight: '0.25rem'
          },
          radioGroup: {
            display: 'flex',
            flexWrap: 'wrap',
            gap: '0.5rem',
            marginBottom: '0.75rem'
          },
          radioLabel: {
            display: 'inline-flex',
            alignItems: 'center',
            padding: '0.5rem',
            border: '1px solid #ddd',
            borderRadius: '4px',
            backgroundColor: '#f5f5f5',
            cursor: 'pointer',
            flex: isMobile ? '1 0 calc(50% - 0.5rem)' : 'auto',
            justifyContent: 'center'
          },
          radioLabelSelected: {
            backgroundColor: '#e3f2fd',
            borderColor: '#2196f3'
          },
          radioInput: {
            marginRight: '0.5rem'
          },
          resultCard: {
            backgroundColor: '#fff',
            padding: '0.75rem',
            borderRadius: '4px',
            boxShadow: '0 1px 3px rgba(0, 0, 0, 0.1)',
            marginBottom: '0.75rem'
          },
          resultTitle: {
            fontSize: '1.1rem',
            marginBottom: '0.5rem',
            textAlign: 'center',
            fontWeight: 'bold'
          },
          resultGrid: {
            display: 'grid',
            gridTemplateColumns: 'repeat(2, 1fr)',
            gap: '0.75rem'
          },
          recommendation: {
            backgroundColor: '#f0f8ff',
            padding: '0.75rem',
            borderRadius: '4px',
            textAlign: 'center',
            margin: '0.75rem 0',
            border: '1px solid #cce5ff'
          },
          sectionTitle: {
            marginBottom: '0.75rem',
            fontSize: '1.2rem',
            fontWeight: 'bold'
          },
          evPositive: {
            color: '#008800',
            fontWeight: 'bold'
          },
          evNegative: {
            color: '#cc0000',
            fontWeight: 'bold'
          },
          calculateButton: {
            backgroundColor: '#2196f3',
            color: 'white',
            padding: '0.75rem',
            borderRadius: '4px',
            border: 'none',
            fontSize: '1rem',
            fontWeight: 'bold',
            cursor: 'pointer',
            width: '100%',
            marginTop: '0.5rem',
            marginBottom: '0.5rem',
            boxShadow: '0 2px 4px rgba(0, 0, 0, 0.1)'
          }
        };
        
        // Custom styles with responsive design
        const styles = {
          container: {
            width: '100%',
            margin: '0 auto',
            backgroundColor: '#fff',
            borderRadius: '8px',
            padding: '1rem',
            boxShadow: '0 2px 5px rgba(0, 0, 0, 0.1)'
          },
        
        return (
          <div style={styles.container}>
            <div style={styles.section}>
              <h2 style={styles.sectionTitle}>Maximum Bet Size</h2>
              <div style={styles.radioGroup}>
                <CustomRadio
                  checked={maxBetSize === 50}
                  onChange={() => setMaxBetSize(50)}
                  label="50 Karma"
                  value="50"
                />
                <CustomRadio
                  checked={maxBetSize === 100}
                  onChange={() => setMaxBetSize(100)}
                  label="100 Karma"
                  value="100"
                />
                <CustomRadio
                  checked={maxBetSize === 200}
                  onChange={() => setMaxBetSize(200)}
                  label="200 Karma"
                  value="200"
                />
              </div>
            </div>
            
            <div style={styles.grid}>
              <div style={styles.section}>
                <h2 style={styles.sectionTitle}>Real App Odds</h2>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Over/Home Team Odds:</label>
                  <div style={styles.inputWrapper}>
                    <input
                      type="text"
                      inputMode="decimal"
                      value={realAppOver}
                      onChange={(e) => setRealAppOver(e.target.value)}
                      onKeyDown={(e) => handleKeyDown(e, 0)}
                      placeholder="e.g. +150 or -120"
                      style={styles.input}
                      ref={realAppOverRef}
                    />
                    <div style={styles.symbolButtons}>
                      <button
                        type="button"
                        onClick={() => setRealAppOver(prev => prev.startsWith('+') ? prev : '+' + prev.replace(/^[+-]/, ''))}
                        style={styles.symbolButton}
                      >
                        +
                      </button>
                      <button
                        type="button"
                        onClick={() => setRealAppOver(prev => prev.startsWith('-') ? prev : '-' + prev.replace(/^[+-]/, ''))}
                        style={styles.symbolButton}
                      >
                        -
                      </button>
                    </div>
                  </div>
                </div>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Under/Away Team Odds:</label>
                  <div style={styles.inputWrapper}>
                    <input
                      type="text"
                      inputMode="decimal"
                      value={realAppUnder}
                      onChange={(e) => setRealAppUnder(e.target.value)}
                      onKeyDown={(e) => handleKeyDown(e, 1)}
                      placeholder="e.g. +150 or -120"
                      style={styles.input}
                      ref={realAppUnderRef}
                    />
                    <div style={styles.symbolButtons}>
                      <button
                        type="button"
                        onClick={() => setRealAppUnder(prev => prev.startsWith('+') ? prev : '+' + prev.replace(/^[+-]/, ''))}
                        style={styles.symbolButton}
                      >
                        +
                      </button>
                      <button
                        type="button"
                        onClick={() => setRealAppUnder(prev => prev.startsWith('-') ? prev : '-' + prev.replace(/^[+-]/, ''))}
                        style={styles.symbolButton}
                      >
                        -
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <div style={styles.section}>
                <h2 style={styles.sectionTitle}>Sportsbook Odds</h2>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Odds Format:</label>
                  <div style={styles.radioGroup}>
                    <CustomRadio
                      checked={oddsFormat === 'american'}
                      onChange={() => setOddsFormat('american')}
                      label="American (+/-)"
                      value="american"
                    />
                    <CustomRadio
                      checked={oddsFormat === 'decimal'}
                      onChange={() => setOddsFormat('decimal')}
                      label="Decimal"
                      value="decimal"
                    />
                  </div>
                </div>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Over/Home Team Odds:</label>
                  <div style={styles.inputWrapper}>
                    <input
                      type="text"
                      inputMode="decimal"
                      value={sbOver}
                      onChange={(e) => setSbOver(e.target.value)}
                      onKeyDown={(e) => handleKeyDown(e, 2)}
                      placeholder={oddsFormat === 'american' ? "e.g. +150 or -120" : "e.g. 2.50"}
                      style={styles.input}
                      ref={sbOverRef}
                    />
                    {oddsFormat === 'american' && (
                      <div style={styles.symbolButtons}>
                        <button
                          type="button"
                          onClick={() => setSbOver(prev => prev.startsWith('+') ? prev : '+' + prev.replace(/^[+-]/, ''))}
                          style={styles.symbolButton}
                        >
                          +
                        </button>
                        <button
                          type="button"
                          onClick={() => setSbOver(prev => prev.startsWith('-') ? prev : '-' + prev.replace(/^[+-]/, ''))}
                          style={styles.symbolButton}
                        >
                          -
                        </button>
                      </div>
                    )}
                  </div>
                </div>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Under/Away Team Odds:</label>
                  <div style={styles.inputWrapper}>
                    <input
                      type="text"
                      inputMode="decimal"
                      value={sbUnder}
                      onChange={(e) => setSbUnder(e.target.value)}
                      onKeyDown={(e) => handleKeyDown(e, 3)}
                      placeholder={oddsFormat === 'american' ? "e.g. +150 or -120" : "e.g. 2.50"}
                      style={styles.input}
                      ref={sbUnderRef}
                    />
                    {oddsFormat === 'american' && (
                      <div style={styles.symbolButtons}>
                        <button
                          type="button"
                          onClick={() => setSbUnder(prev => prev.startsWith('+') ? prev : '+' + prev.replace(/^[+-]/, ''))}
                          style={styles.symbolButton}
                        >
                          +
                        </button>
                        <button
                          type="button"
                          onClick={() => setSbUnder(prev => prev.startsWith('-') ? prev : '-' + prev.replace(/^[+-]/, ''))}
                          style={styles.symbolButton}
                        >
                          -
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>
            
            {evMaxOver !== null && evMaxUnder !== null && evZeroOver !== null && evZeroUnder !== null && (
              <div style={styles.section}>
                <h2 style={styles.sectionTitle}>Expected Value Results</h2>
                
                <div style={styles.grid}>
                  <div style={styles.resultCard}>
                    <h3 style={styles.resultTitle}>Over/Home Team</h3>
                    <div style={styles.resultGrid}>
                      <div>
                        <div style={{fontWeight: 'bold'}}>Max Bet EV:</div>
                        <div style={evMaxOver >= 0 ? styles.evPositive : styles.evNegative}>
                          {evMaxOver.toFixed(2)} karma
                        </div>
                      </div>
                      <div>
                        <div style={{fontWeight: 'bold'}}>Zero Bet EV:</div>
                        <div style={evZeroOver >= 0 ? styles.evPositive : styles.evNegative}>
                          {evZeroOver.toFixed(2)} karma
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div style={styles.resultCard}>
                    <h3 style={styles.resultTitle}>Under/Away Team</h3>
                    <div style={styles.resultGrid}>
                      <div>
                        <div style={{fontWeight: 'bold'}}>Max Bet EV:</div>
                        <div style={evMaxUnder >= 0 ? styles.evPositive : styles.evNegative}>
                          {evMaxUnder.toFixed(2)} karma
                        </div>
                      </div>
                      <div>
                        <div style={{fontWeight: 'bold'}}>Zero Bet EV:</div>
                        <div style={evZeroUnder >= 0 ? styles.evPositive : styles.evNegative}>
                          {evZeroUnder.toFixed(2)} karma
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div style={styles.recommendation}>
                  <div style={{fontWeight: 'bold', fontSize: '1.1rem', marginBottom: '0.5rem'}}>Recommended Bet:</div>
                  {(() => {
                    // Find the highest EV among all options
                    const evOptions = [
                      { type: "Max Over", value: evMaxOver, side: "Over/Home Team", amount: maxBetSize },
                      { type: "Zero Over", value: evZeroOver, side: "Over/Home Team", amount: maxBetSize >= 100 ? 10 : 5 },
                      { type: "Max Under", value: evMaxUnder, side: "Under/Away Team", amount: maxBetSize },
                      { type: "Zero Under", value: evZeroUnder, side: "Under/Away Team", amount: maxBetSize >= 100 ? 10 : 5 }
                    ];
                    
                    const bestOption = evOptions.reduce((best, current) => 
                      current.value > best.value ? current : best, { value: -Infinity });
                    
                    if (bestOption.value <= 0) {
                      return <div style={{fontSize: '1.1rem'}}>None - all bets have negative or zero EV</div>;
                    }
                    
                    return (
                      <div style={{fontSize: '1.1rem'}}>
                        {bestOption.type.includes("Max") ? "Max" : "Zero"} bet on {bestOption.side} ({bestOption.amount} karma)
                        <div style={{color: '#008800', fontWeight: 'bold', marginTop: '0.5rem'}}>
                          Expected Value: {bestOption.value.toFixed(2)} karma
                        </div>
                      </div>
                    );
                  })()}
                </div>
              </div>
            )}
          </div>
        );
      };

      // Render the component to the DOM
      ReactDOM.render(<KarmaBettingCalculator />, document.getElementById('calculator-root'));
    </script>
  </body>
</html>
