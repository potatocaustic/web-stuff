<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Karma Betting Calculator - caustic.info</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="https://raw.githubusercontent.com/potatocaustic/web-stuff/refs/heads/main/favicon.ico" type="image/x-icon" />
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>
  <body>
    <header>
      <h1>Karma Betting Expected Value Calculator</h1>
    </header>
    <main>
      <section class="info">
        <p>Calculate the expected value of karma bets by comparing Real App odds with Sportsbook odds.</p>
      </section>
      <section class="form-section">
        <!-- This is where our React component will be rendered -->
        <div id="calculator-root"></div>
      </section>
    </main>
    <footer>
      <p>&copy; caustic.info</p>
    </footer>

    <!-- Calculator Script -->
    <script type="text/babel">
      // React component for the Karma Betting Calculator
      const KarmaBettingCalculator = () => {
        // State for form inputs
        const [realAppOver, setRealAppOver] = React.useState('+100');
        const [realAppUnder, setRealAppUnder] = React.useState('+100');
        const [sbOver, setSbOver] = React.useState('');
        const [sbUnder, setSbUnder] = React.useState('');
        const [oddsFormat, setOddsFormat] = React.useState('american');
        const [maxBetSize, setMaxBetSize] = React.useState(100);
        
        // State for calculated values
        const [noVigProbOver, setNoVigProbOver] = React.useState(null);
        const [noVigProbUnder, setNoVigProbUnder] = React.useState(null);
        const [evMaxOver, setEvMaxOver] = React.useState(null);
        const [evMaxUnder, setEvMaxUnder] = React.useState(null);
        const [evZeroOver, setEvZeroOver] = React.useState(null);
        const [evZeroUnder, setEvZeroUnder] = React.useState(null);
        
        // Refs for input fields to manage focus
        const realAppOverRef = React.useRef(null);
        const realAppUnderRef = React.useRef(null);
        const sbOverRef = React.useRef(null);
        const sbUnderRef = React.useRef(null);
        
        // Focus order for keyboard navigation
        const inputOrder = [realAppOverRef, realAppUnderRef, sbOverRef, sbUnderRef];
        
        // Handle enter key to move to next input
        const handleKeyDown = (e, currentIndex) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            const nextIndex = (currentIndex + 1) % inputOrder.length;
            inputOrder[nextIndex].current.focus();
          }
        };
        
        // Helper functions for odds conversion
        const americanToDecimal = (american) => {
          if (!american) return null;
          let value = parseFloat(american);
          if (isNaN(value)) return null;
          
          // If the string doesn't start with "+", but is a positive number
          // it should be treated as positive American odds
          if (!american.toString().startsWith('-') && !american.toString().startsWith('+')) {
            value = Math.abs(value);
          }
          
          if (value > 0) {
            return (value / 100) + 1;
          } else {
            return (100 / Math.abs(value)) + 1;
          }
        };
        
        const americanToImpliedProb = (american) => {
          const decimal = americanToDecimal(american);
          if (!decimal) return null;
          return 1 / decimal;
        };
        
        const decimalToImpliedProb = (decimal) => {
          if (!decimal) return null;
          const value = parseFloat(decimal);
          if (isNaN(value) || value <= 0) return null;
          return 1 / value;
        };
        
        const calculateNoVigProbabilities = () => {
          let probOver, probUnder;
          
          // Calculate implied probabilities based on selected odds format
          if (oddsFormat === 'american') {
            probOver = americanToImpliedProb(sbOver);
            probUnder = americanToImpliedProb(sbUnder);
          } else {
            probOver = decimalToImpliedProb(sbOver);
            probUnder = decimalToImpliedProb(sbUnder);
          }
          
          if (!probOver || !probUnder) return { over: null, under: null };
          
          // Calculate the vig
          const vig = probOver + probUnder - 1;
          
          // Remove the vig to get the no-vig probabilities
          const noVigProbOver = probOver / (probOver + probUnder);
          const noVigProbUnder = probUnder / (probOver + probUnder);
          
          return { over: noVigProbOver, under: noVigProbUnder };
        };
        
        const calculateWinValue = (odds, betSize) => {
          if (!odds) return null;
          let value = parseFloat(odds);
          if (isNaN(value)) return null;
          
          // If the string doesn't start with "+", but is a positive number
          // it should be treated as positive American odds
          if (!odds.toString().startsWith('-') && !odds.toString().startsWith('+')) {
            value = Math.abs(value);
          }
          
          if (value > 0) {
            return (value / 100) * betSize;
          } else {
            return (100 / Math.abs(value)) * betSize;
          }
        };
        
        const calculateExpectedValue = (winProb, winValue, lossProb, lossValue) => {
          if (winProb === null || winValue === null || lossProb === null || lossValue === null) {
            return null;
          }
          return (winProb * winValue) + (lossProb * lossValue);
        };
        
        // Update calculations when inputs change
        React.useEffect(() => {
          if (!realAppOver || !realAppUnder || !sbOver || !sbUnder) {
            // Don't calculate if inputs are missing
            return;
          }
          
          const { over: overProb, under: underProb } = calculateNoVigProbabilities();
          setNoVigProbOver(overProb);
          setNoVigProbUnder(underProb);
          
          if (overProb === null || underProb === null) {
            return;
          }
          
          // Calculate max bet EVs
          const winValueMaxOver = calculateWinValue(realAppOver, maxBetSize);
          const lossValueMax = -maxBetSize;
          const evMaxOverCalc = calculateExpectedValue(overProb, winValueMaxOver, underProb, lossValueMax);
          setEvMaxOver(evMaxOverCalc);
          
          const winValueMaxUnder = calculateWinValue(realAppUnder, maxBetSize);
          const evMaxUnderCalc = calculateExpectedValue(underProb, winValueMaxUnder, overProb, lossValueMax);
          setEvMaxUnder(evMaxUnderCalc);
          
          // Calculate zero bet EVs
          const zeroBetSize = maxBetSize >= 100 ? 10 : 5;
          const winValueZeroOver = calculateWinValue(realAppOver, zeroBetSize);
          const evZeroOverCalc = calculateExpectedValue(overProb, winValueZeroOver, 0, 0);
          setEvZeroOver(evZeroOverCalc);
          
          const winValueZeroUnder = calculateWinValue(realAppUnder, zeroBetSize);
          const evZeroUnderCalc = calculateExpectedValue(underProb, winValueZeroUnder, 0, 0);
          setEvZeroUnder(evZeroUnderCalc);
        }, [realAppOver, realAppUnder, sbOver, sbUnder, oddsFormat, maxBetSize]);
        
        // Custom styles to match your website's CSS
        const styles = {
          container: {
            maxWidth: '800px',
            margin: '0 auto',
            backgroundColor: '#fff',
            borderRadius: '8px',
            padding: '1.5rem',
            boxShadow: '0 2px 5px rgba(0, 0, 0, 0.1)'
          },
          section: {
            marginBottom: '1.5rem',
            padding: '1rem',
            borderRadius: '8px',
            backgroundColor: '#f9f9f9',
            border: '1px solid #eee'
          },
          grid: {
            display: 'grid',
            gridTemplateColumns: 'repeat(2, 1fr)',
            gap: '1.5rem',
            marginBottom: '1.5rem'
          },
          inputGroup: {
            marginBottom: '1rem'
          },
          label: {
            display: 'block',
            marginBottom: '0.5rem',
            fontWeight: 'bold'
          },
          input: {
            width: '100%',
            padding: '0.5rem',
            border: '1px solid #ccc',
            borderRadius: '4px'
          },
          radioGroup: {
            display: 'flex',
            gap: '1rem',
            marginBottom: '1rem'
          },
          resultCard: {
            backgroundColor: '#fff',
            padding: '1rem',
            borderRadius: '4px',
            boxShadow: '0 2px 4px rgba(0, 0, 0, 0.1)',
            marginBottom: '1rem'
          },
          resultTitle: {
            fontSize: '1.2rem',
            marginBottom: '0.5rem',
            textAlign: 'center'
          },
          resultGrid: {
            display: 'grid',
            gridTemplateColumns: 'repeat(2, 1fr)',
            gap: '1rem'
          },
          recommendation: {
            backgroundColor: '#f0f8ff',
            padding: '1rem',
            borderRadius: '4px',
            textAlign: 'center',
            margin: '1rem 0'
          },
          evPositive: {
            color: '#008800',
            fontWeight: 'bold'
          },
          evNegative: {
            color: '#cc0000',
            fontWeight: 'bold'
          }
        };
        
        return (
          <div style={styles.container}>
            <div style={styles.section}>
              <h2 style={{marginBottom: '1rem'}}>Maximum Bet Size</h2>
              <div style={styles.radioGroup}>
                <label style={{display: 'inline-flex', alignItems: 'center'}}>
                  <input
                    type="radio"
                    checked={maxBetSize === 50}
                    onChange={() => setMaxBetSize(50)}
                    style={{marginRight: '0.5rem'}}
                  />
                  50 Karma
                </label>
                <label style={{display: 'inline-flex', alignItems: 'center'}}>
                  <input
                    type="radio"
                    checked={maxBetSize === 100}
                    onChange={() => setMaxBetSize(100)}
                    style={{marginRight: '0.5rem'}}
                  />
                  100 Karma
                </label>
                <label style={{display: 'inline-flex', alignItems: 'center'}}>
                  <input
                    type="radio"
                    checked={maxBetSize === 200}
                    onChange={() => setMaxBetSize(200)}
                    style={{marginRight: '0.5rem'}}
                  />
                  200 Karma
                </label>
              </div>
            </div>
            
            <div style={styles.grid}>
              <div style={styles.section}>
                <h2 style={{marginBottom: '1rem'}}>Real App Odds</h2>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Over/Home Team Odds:</label>
                  <input
                    type="text"
                    value={realAppOver}
                    onChange={(e) => setRealAppOver(e.target.value)}
                    onKeyDown={(e) => handleKeyDown(e, 0)}
                    placeholder="e.g. 150 or -120"
                    style={styles.input}
                    ref={realAppOverRef}
                  />
                </div>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Under/Away Team Odds:</label>
                  <input
                    type="text"
                    value={realAppUnder}
                    onChange={(e) => setRealAppUnder(e.target.value)}
                    onKeyDown={(e) => handleKeyDown(e, 1)}
                    placeholder="e.g. 150 or -120"
                    style={styles.input}
                    ref={realAppUnderRef}
                  />
                </div>
              </div>
              
              <div style={styles.section}>
                <h2 style={{marginBottom: '1rem'}}>Sportsbook Odds</h2>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Odds Format:</label>
                  <div style={styles.radioGroup}>
                    <label style={{display: 'inline-flex', alignItems: 'center'}}>
                      <input
                        type="radio"
                        checked={oddsFormat === 'american'}
                        onChange={() => setOddsFormat('american')}
                        style={{marginRight: '0.5rem'}}
                      />
                      American (+/-)
                    </label>
                    <label style={{display: 'inline-flex', alignItems: 'center'}}>
                      <input
                        type="radio"
                        checked={oddsFormat === 'decimal'}
                        onChange={() => setOddsFormat('decimal')}
                        style={{marginRight: '0.5rem'}}
                      />
                      Decimal
                    </label>
                  </div>
                </div>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Over/Home Team Odds:</label>
                  <input
                    type="text"
                    value={sbOver}
                    onChange={(e) => setSbOver(e.target.value)}
                    onKeyDown={(e) => handleKeyDown(e, 2)}
                    placeholder={oddsFormat === 'american' ? "e.g. 150 or -120" : "e.g. 2.50"}
                    style={styles.input}
                    ref={sbOverRef}
                  />
                </div>
                <div style={styles.inputGroup}>
                  <label style={styles.label}>Under/Away Team Odds:</label>
                  <input
                    type="text"
                    value={sbUnder}
                    onChange={(e) => setSbUnder(e.target.value)}
                    onKeyDown={(e) => handleKeyDown(e, 3)}
                    placeholder={oddsFormat === 'american' ? "e.g. 150 or -120" : "e.g. 2.50"}
                    style={styles.input}
                    ref={sbUnderRef}
                  />
                </div>
              </div>
            </div>
            
            {evMaxOver !== null && evMaxUnder !== null && evZeroOver !== null && evZeroUnder !== null && (
              <div style={styles.section}>
                <h2 style={{marginBottom: '1rem'}}>Expected Value Results</h2>
                
                <div style={styles.grid}>
                  <div style={styles.resultCard}>
                    <h3 style={styles.resultTitle}>Over/Home Team</h3>
                    <div style={styles.resultGrid}>
                      <div>
                        <div style={{fontWeight: 'bold'}}>Max Bet EV:</div>
                        <div style={evMaxOver >= 0 ? styles.evPositive : styles.evNegative}>
                          {evMaxOver.toFixed(2)} karma
                        </div>
                      </div>
                      <div>
                        <div style={{fontWeight: 'bold'}}>Zero Bet EV:</div>
                        <div style={evZeroOver >= 0 ? styles.evPositive : styles.evNegative}>
                          {evZeroOver.toFixed(2)} karma
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <div style={styles.resultCard}>
                    <h3 style={styles.resultTitle}>Under/Away Team</h3>
                    <div style={styles.resultGrid}>
                      <div>
                        <div style={{fontWeight: 'bold'}}>Max Bet EV:</div>
                        <div style={evMaxUnder >= 0 ? styles.evPositive : styles.evNegative}>
                          {evMaxUnder.toFixed(2)} karma
                        </div>
                      </div>
                      <div>
                        <div style={{fontWeight: 'bold'}}>Zero Bet EV:</div>
                        <div style={evZeroUnder >= 0 ? styles.evPositive : styles.evNegative}>
                          {evZeroUnder.toFixed(2)} karma
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div style={styles.recommendation}>
                  <div style={{fontWeight: 'bold', fontSize: '1.2rem', marginBottom: '0.5rem'}}>Recommended Bet:</div>
                  {(() => {
                    // Find the highest EV among all options
                    const evOptions = [
                      { type: "Max Over", value: evMaxOver, side: "Over/Home Team", amount: maxBetSize },
                      { type: "Zero Over", value: evZeroOver, side: "Over/Home Team", amount: maxBetSize >= 100 ? 10 : 5 },
                      { type: "Max Under", value: evMaxUnder, side: "Under/Away Team", amount: maxBetSize },
                      { type: "Zero Under", value: evZeroUnder, side: "Under/Away Team", amount: maxBetSize >= 100 ? 10 : 5 }
                    ];
                    
                    const bestOption = evOptions.reduce((best, current) => 
                      current.value > best.value ? current : best, { value: -Infinity });
                    
                    if (bestOption.value <= 0) {
                      return <div style={{fontSize: '1.1rem'}}>None - all bets have negative or zero EV</div>;
                    }
                    
                    return (
                      <div style={{fontSize: '1.1rem'}}>
                        {bestOption.type.includes("Max") ? "Max" : "Zero"} bet on {bestOption.side} ({bestOption.amount} karma)
                        <div style={{color: '#008800', fontWeight: 'bold', marginTop: '0.5rem'}}>
                          Expected Value: {bestOption.value.toFixed(2)} karma
                        </div>
                      </div>
                    );
                  })()}
                </div>
              </div>
            )}
          </div>
        );
      };

      // Render the component to the DOM
      ReactDOM.render(<KarmaBettingCalculator />, document.getElementById('calculator-root'));
    </script>
  </body>
</html>
